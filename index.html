<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CodeMirror JSON Folding</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.63.0/codemirror.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.63.0/theme/material-darker.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.63.0/addon/fold/foldgutter.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.63.0/codemirror.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.63.0/mode/javascript/javascript.min.js"></script>

    <!-- Folding Add-ons -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.63.0/addon/fold/foldcode.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.63.0/addon/fold/foldgutter.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.63.0/addon/fold/brace-fold.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.63.0/addon/fold/comment-fold.min.js"></script>
    
    <style>
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
            background-color: #282c34;
            color: #e8e8e8;
        }
        .body-container {
            display: flex;
            /* flex-wrap: wrap; */
            gap: 10px;
            justify-content: center;
            /* align-items: flex-start; */
            padding: 20px;
        }
        .editor-container {
            width: 45%;
            height: 700px;
            border: 1px solid #444;
            position: relative;
        }
        .CodeMirror {
            height: 100%;
        }
        .header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            background: #333;
            color: white;
            padding: 10px;
        }
        .diff-actions {
            display: flex;
            flex-direction: column;
            gap: 1rem;
            justify-content: center;
        }
        .diff-actions button {
            padding: 10px 20px;
            background-color: #007bff;
            border: none;
            color: white;
            font-size: 16px;
            cursor: pointer;
            border-radius: 5px;
        }
        .diff-actions button:hover {
            background-color: #0056b3;
        }
        /* .differences-panel {
            width: 100%;
            background: #222;
            padding: 15px;
            margin-top: 10px;
            border-radius: 5px;
            min-height: 100px;
        } */
        /* Fullscreen Mode */
        .fullscreen {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: 9999;
            background: #000;
        }
        .errorHighlight {
            background-color: rgba(255, 0, 0, 0.3); /* Light red */
        }
        .header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding: 10px 0;
            border-bottom: 1px solid #ddd;
        }

        .logo-section {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .logo {
            font-size: 24px;
            font-weight: bold;
            color: #007bff;
        }

        .subtitle {
            color: #666;
            font-size: 14px;
        }
    </style>
</head>
<body>

    <header class="header">
        <div class="logo-section">
            <div class="logo">JSON DIFFY</div>
            <div class="subtitle">Advanced JSON Comparison for Precise Data Insights</div>
            <p class="subtitle">Effortlessly compare two JSON documents with our advanced comparison tool. Identify differences at every level, including structural changes, missing or added keys, and modified values. Our intelligent algorithm not only highlights discrepancies but also provides a detailed breakdown for seamless analysis. Whether you're debugging APIs, validating data, or merging configurations, our tool ensures accuracy and efficiency. Experience a smarter way to compare JSON with intuitive, user-friendly visualization and deep-level insights.</p>
        </div>
        <div class="button-group">
            <!-- <button id="clearBtn" onclick="clearEditor(editorRight,blnAll=true)">‚ùå Cleare</button> -->
        </div>
    </header>
    <div class="body-container">        
        <!-- Left Editor -->
        <div class="editor-container" id="leftEditorSection">
            <div class="header">
                <span>Left Editor</span>
                <button id="cleareditor1" onclick="clearEditor(editorLeft)">‚ùå Cleare</button>
                <button id="copyTextLeft" data-tooltip="Copy">üìã Copy</button>
                <button onclick="toggleFullScreen('leftEditorSection')">üî≥ Fullscreen</button>
            </div>
            <textarea id="editorLeft"></textarea>
        </div>

        <!-- Compare Button -->
        <div class="diff-actions">
            <button id="compareBtn">Compare</button>
            <button id="swapBtn">Swap</button>
        </div>

        <!-- Right Editor -->
        <div class="editor-container" id="rightEditorSection">
            <div class="header">
                <span>Right Editor</span>
                <button id="cleareditor1" onclick="clearEditor(editorRight)">‚ùåCleare</button>
                <button id="copyTextRight" data-tooltip="Copy">üìã Copy</button>
                <button onclick="toggleFullScreen('rightEditorSection')">üî≥ Fullscreen</button>
            </div>
            <textarea id="editorRight"></textarea>
        </div>

        <div class="differences-panel" id="errorList">
            <h3 style="margin-bottom: 15px; color: #e8e8e8;">Differences</h3>
            <div id="errors"></div>
        </div>
    </div>


    <script>
        // Common CodeMirror Configuration
        const commonConfig = {
            lineNumbers: true,
            mode: { name: 'javascript', json: true }, // Ensures JSON mode
            theme: 'material-darker',
            matchBrackets: true,
            autoCloseBrackets: true,
            foldGutter: true, // Enables folding
            gutters: ["CodeMirror-linenumbers", "CodeMirror-foldgutter"] // Adds folding gutter
        };

        // Initialize Editors
        const editorLeft = CodeMirror.fromTextArea(document.getElementById('editorLeft'), commonConfig);
        const editorRight = CodeMirror.fromTextArea(document.getElementById('editorRight'), commonConfig);


        // for left input
        document.getElementById('copyTextLeft').onclick = function () {
            copyText(editorLeft);
        };

        // for right input
        document.getElementById('copyTextRight').onclick = function () {
            copyText(editorRight);
        };

        // Set Default JSON for Testing
        const defaultLeftJSON = {
            project: "JSON Diff Tool",
            features: ["Auto Detect", "Collapsible JSON"]
        };
        const defaultRightJSON = {
            project: "JSON Diff Tool",
            features: ["Auto Detect", "Collapsible JSON"]
        };

        editorLeft.setValue(JSON.stringify(defaultLeftJSON, null, 2));
        editorRight.setValue(JSON.stringify(defaultRightJSON, null, 2));

        editorLeft.refresh();
        editorRight.refresh();

        // swapEditors function
        document.getElementById('swapBtn').addEventListener('click', () => {
            const value1 = editorLeft.getValue();
            const value2 = editorRight.getValue();
            editorLeft.setValue(value2);
            editorRight.setValue(value1);
        });

        /**
         * cleare function
         * 
         * */
        function clearEditor(editorInstance,blnAll = false) {
            if (blnAll){
                editorLeft.setValue('');
                editorRight.setValue('');

            clearHighlights();
            } else {
                editorInstance.setValue('');
            }
            document.getElementById('diffList').innerHTML = '';
        }


        /**
         * copy function
         * 
         * */
         function copyText(editorInstance) {
            let text = editorInstance.getValue(); // Get only the actual content
            text = text.replace(/[\u200B-\u200D\uFEFF]/g, ''); // Remove any invisible characters

            // Copy text to clipboard using Clipboard API
            navigator.clipboard.writeText(text).then(() => {
                console.log("Copied successfully!");
            }).catch(err => {
                console.error("Failed to copy:", err);
            });
        }
        // Fullscreen Toggle
        function toggleFullScreen(editorId) {
            var element = document.getElementById(editorId);
            element.classList.toggle("fullscreen");
        }

        // Compare Button Functionality (Placeholder)
        document.getElementById('compareBtn').addEventListener('click', function () {
            let leftJSON, rightJSON, leftLines, rightLines;
            try {

                leftLines = editorLeft.getValue().split("\n");
                rightLines = editorRight.getValue().split("\n");
                
                leftJSON = JSON.parse(editorLeft.getValue());
                rightJSON = JSON.parse(editorRight.getValue());
            } catch (e) {
                document.getElementById("errors").innerHTML = `<p style="color: red;">Invalid JSON detected!</p>`;
                return;
            }
            compareJSON(leftLines, rightLines);
        });

        // Simple JSON Comparison Function
        function compareJSON(leftLines, rightLines) {
            clearHighlights();
            let maxLines = Math.max(leftLines.length, rightLines.length);
            let errors = [];

            for (let i = 0; i < maxLines; i++) {
                const leftLine = leftLines[i] || '';
                const rightLine = rightLines[i] || '';
                if (leftLine !== rightLine) {
                    errors.push({ line: i + 1, left: leftLine, right: rightLine });
                    highlightError(editorLeft, i, leftLine.length);
                    highlightError(editorRight, i, rightLine.length);
                }
            }
            renderErrors(errors);
        }

        function clearHighlights() {
            editorLeft.getAllMarks().forEach(mark => mark.clear());
            editorRight.getAllMarks().forEach(mark => mark.clear());
        }

        function highlightError(editor, line, length) {
            editor.markText({ line, ch: 0 }, { line, ch: length }, { className: 'errorHighlight' });
        }

        function renderErrors(errors) {
            const errorList = document.getElementById('errorList');
            const errorsContainer = document.getElementById('errors');
            errorsContainer.innerHTML = '';
            
            if (errors.length > 0) {
                errorList.style.display = 'block';
                errors.forEach(error => {
                    const errorItem = document.createElement('div');
                    errorItem.className = 'diff-item';
                    errorItem.textContent = `Line ${error.line}: Click to View`;
                    errorItem.onclick = () => scrollToLine(error.line);
                    errorsContainer.appendChild(errorItem);
                });
            } else {
                // errorList.style.display = 'none';
                errorsContainer.innerHTML = `<p style="color: lightgreen;">No differences found.</p>`;
            }
        }

        function scrollToLine(line) {
            editorLeft.scrollIntoView({ line, ch: 0 });
            editorRight.scrollIntoView({ line, ch: 0 });
        }
    </script>
</body>
</html>
